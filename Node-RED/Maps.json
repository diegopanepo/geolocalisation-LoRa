[
    {
        "id": "1bfce95a.d815e7",
        "type": "template",
        "z": "245d917e.be4646",
        "name": "Map",
        "field": "payload",
        "fieldType": "msg",
        "syntax": "mustache",
        "template": "<!DOCTYPE html>\n<html>\n<head>\n  <title>Supply Chain</title>\n  <script src=\"https://ajax.googleapis.com/ajax/libs/jquery/1.6.4/jquery.min.js\"></script>\n  <script src=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyAxuxffizWf5rlO5UHZE4Rt4POasJY0om4\"></script>\n  <script src=\"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/markerclusterer.js\"></script>\n\n  <style type=\"text/css\" media=\"screen\">\n    #map {\n      position:absolute;\n      top: 0; bottom: 0; left: 0; right: 0;\n    }\n  </style>\n</head>\n<body>\n  <div id=\"map\"></div>\n  <script type=\"text/javascript\">\n\n$(document).ready(function(){\n  var MAP_ZOOM = 14;//14\n  var MARKER_SIZE = 24;\n  \n  var map = new google.maps.Map(document.getElementById('map'), {\n      zoom: MAP_ZOOM,\n      center: {lat: 43.6239695, lng: 7.0509146}, //{lat: 43.737450, lng: 7.048596}\n      //mapTypeId: 'satellite'\n      mapTypeId: 'terrain'\n    });\n\n//flightPlanCoordinates\n    //var hist11 = global.get(\"tab_historique1\")[0];\n/*    var cheminTracker11 = [\n          {lat: 43.6234, lng: 7.0523},\n          {lat: 43.6235, lng: 7.0524},\n          {lat: 43.6236, lng: 7.0523},\n          {lat: 43.6238, lng: 7.0525}\n        ];\n    var flightPath11 = new google.maps.Polyline({\n      path: cheminTracker11,\n      geodesic: true,\n      strokeColor: '#FF0000',\n      strokeOpacity: 1.0,\n      strokeWeight: 2\n    });\n\n    flightPath11.setMap(map);\n*/\n/*\n    var hist11 = global.get(\"tab_historique1\");\n    var taille11 = hist11.length;\n    var cheminTracker11 = [];\n    // for(let i = 0; i < taille11; i++) {\n    //     cheminTracker11.push({lat: hist11[i++], lng: hist11[i]});\n    // }\n    var flightPath11 = new google.maps.Polyline({\n      path: cheminTracker11,\n      geodesic: true,\n      strokeColor: '#FF0000',\n      strokeOpacity: 1.0,\n      strokeWeight: 2\n    });\n    \n    flightPath11.setMap(map);\n*/\n    \n  var markers = [];\n  var tab = [];\n  \n  window.onmessage = function(evt){\n    console.log(\"ENTERING ON MESSAGE\");  \n    /*for (var i = 0; i < markers.length; i++) {\n      markers[i].setMap(null);\n    }*/\n    var data = JSON.parse(evt.data);\n    \n    var marker1 = tab[data.description]|| null;\n    if (marker1 !=null){\n        marker1.setMap(null);\n    }\n    \n    \n    var data1 = [];\n    if (typeof data.fixed_icon != \"undefined\") {\n        for (var i=0; i<data.fixed_icon.length ; i++ ) {\n            data.fixed_icon[i].fixed_icon = true;\n            data1.push(data.fixed_icon[i]);\n        }\n    }\n    data.fixed_icon = false;\n    data1.push(data);\n    console.log(\"DATA:\"+JSON.stringify(data1));\n    map.setZoom(MAP_ZOOM);\n    \n    markers = data1.map(function(el, i) {\n      var marker;\n      if (el.fixed_icon === true) {\n         marker = new google.maps.Marker({\n            position: el,\n            icon: {\n              url: el.iconUrl,\n              scaledSize: new google.maps.Size(MARKER_SIZE, MARKER_SIZE)\n            },\n            map:map\n         });\n         tab[data.description]=marker;\n      } else {\n         marker = new google.maps.Marker({\n            position: el,\n            icon: {\n            //path: google.maps.SymbolPath.CIRCLE,\n            scale: 3\n            },\n        //icon: {\n        //  url: el.iconUrl,\n        //  scaledSize: new google.maps.Size(MARKER_SIZE, MARKER_SIZE)\n        //},\n        map:map\n      });\n          tab[data.description]=marker;\n      }\n      //tab[data.description]=marker;\n      google.maps.event.addListener(marker , 'click', function(){\n        var infowindow = new google.maps.InfoWindow({\n          content:el.description,\n          position: el,\n        });\n        infowindow.open(map);\n        setTimeout(function () { infowindow.close(); }, 2000);\n      });\n      return marker\n    });\n  }\n});\n  </script>\n</body>\n</html>",
        "x": 530,
        "y": 340,
        "wires": [
            [
                "535eac65.78208c"
            ]
        ]
    }
]